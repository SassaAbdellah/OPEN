<?xml version="1.0" encoding="UTF-8"?>
<project name="OpenRideServer" default="all" basedir=".">
    <description>Builds the project OpenRideServer</description>

    <!-- local.properties will always be sourced -->
    <property file="local.properties"  />

    <!-- directory where we assemble the stuff before it goes to the ear -->
    <property name="build.dir" value="build" />

    
    <!-- dist.dir is the directory where the ear gets created -->
    <property name="dist.dir" value="dist" />



   <!-- ************************************************************************ -->
   <!-- **** joride target is only to be build if build.joride param is set **** -->
   <!-- ************************************************************************ -->
   <target name="joride" description="build the joride subproject"  if="build.joride" >

    <echo> *** building joride subproject  *** </echo>

    <ant  dir="joride"                      antfile="build.headless.xml"           />
    <copy file="joride/dist/joride.war"     todir="${build.dir}"                   />
   </target> <!-- joride -->


   <!-- ************************************************************************ -->
   <!-- **** OpenRideWeb Project is to be build only if "build.OpenRideWeb" **** -->
   <!-- **** Parameter is set                                               **** -->
   <!-- ************************************************************************ -->
   <target name="OpenRideWeb" description="build the OpenRideWeb subproject"  if="build.OpenRideWeb" >

    <echo> *** building OpenRideWeb subproject  *** </echo>


    <!--build OpenRideWeb     subproject  ************************************************ -->
    <ant  dir="OpenRideWeb"  antfile="build.headless.xml"                                   />
    <copy file="OpenRideWeb/dist/OpenRideWeb.war" todir="${build.dir}"                      /> 

    </target>


   <!-- **************************************************************************** -->
   <!-- **** OpenRideAdmin Project is to be build only if "build.OpenRideAdmin" **** -->
   <!-- **** Parameter is set                                                   **** -->
   <!-- **************************************************************************** -->
   <target name="OpenRideAdmin" description="build the OpenRideAdmin subproject"  if="build.OpenRideAdmin" >

    <echo> *** building OpenRideAdmin subproject  *** </echo>
    <!--build OpenRideAdmin     subproject  ************************************************ -->

    <ant  dir="OpenRideAdmin"  antfile="build.headless.xml"                                   />
    <copy file="OpenRideAdmin/dist/OpenRideAdmin.war" todir="${build.dir}"                    />

    </target>



   <!-- ************************************************************************************ -->
   <!-- **** OpenRideServer-RS Project is to be build only if "build.OpenRideServer-RS" **** -->
   <!-- **** Parameter is set                                                           **** -->
   <!-- ************************************************************************************ -->

   <target name="OpenRideServer-RS" description="build the OpenRideServer-RS subproject"  if="build.OpenRideServer-RS" >

    <echo> *** building OpenRideServer-RS subproject  *** </echo>
    <!--build OpenRideServer-RS     subproject  ************************************************ -->

    <ant  dir="OpenRideServer-RS"  antfile="build.headless.xml"                                   />
    <copy file="OpenRideServer-RS/dist/OpenRideServer-RS.war" todir="${build.dir}"                    />

    </target>










 
    <!-- ******************************************** -->
    <!-- ***  target "dist": create the ear file  *** -->	
    <!-- ******************************************** -->
    
  <target name="dist" description=" target dist: create the ear file "  >

    <!-- assemble stuff in build.dir -->
    <mkdir dir="${build.dir}" /> 


    <!--build OpenRideServer      subproject  ************************************************ -->
    <ant  dir="OpenRideServer-ejb"  antfile="build.headless.xml"                                />
    <copy file="OpenRideServer-ejb/dist/OpenRideServer-ejb.jar" todir="${build.dir}"            /> 




    <!--build OpenRideWeb         subproject  ************************************************ -->
    <antcall target="OpenRideWeb" inheritAll="true" inheritRefs="true" />






    <!--build OpenRideServer-RS subproject       ************************************************* -->
    <antcall target="OpenRideServer-RS" inheritAll="true" inheritRefs="true" />

    <!--build OpenRideAdmin subproject       ************************************************* -->
    <antcall target="OpenRideAdmin" inheritAll="true" inheritRefs="true" />


    <!--build joride subproject              ************************************************* -->
    <antcall target="joride" inheritAll="true" inheritRefs="true" />




    <!-- Add libraries *********************************************************************** -->
    <copy  todir="${build.dir}/lib"  >       
      <fileset dir="OpenRideServer-ejb/libs">
        <include name="**/*.jar"  />
        <include name="**/*.docx" />
      </fileset>
    </copy>

 


    <!-- create destination directory -->  
    <mkdir dir="${dist.dir}" />


      <jar destfile="${dist.dir}/${ant.project.name}.ear" >
       <fileset  dir="${build.dir}" />

      </jar>

    </target> <!-- ent of target "dist" -->

   
 
    <!-- ********************************************************* -->
    <!-- *** target clean: cleanup dist and build directories  *** -->	
    <!-- ********************************************************* -->
   
   <target name="clean" description="cleanup build artefacts" >
	<delete dir="${dist.dir}"  />
	<delete dir="${build.dir}" />


       <!--clean  subprojects  ***************************************************** -->
       <ant  dir="OpenRideServer-ejb"   antfile="build.headless.xml"   target="clean" />
       <ant  dir="OpenRideWeb"          antfile="build.headless.xml"   target="clean" />
       <ant  dir="OpenRideServer-RS"    antfile="build.headless.xml"   target="clean" />
       <ant  dir="OpenRideAdmin"        antfile="build.headless.xml"   target="clean" />

   </target> <!-- end of target clean -->
  

   <!-- ******************************************* -->
   <!-- ***  target "all":  do clean, then dist *** -->
   <!-- ******************************************* -->

   <target name="all"  depends="clean,dist"  description="first clean, then dist..." />
    
</project>
